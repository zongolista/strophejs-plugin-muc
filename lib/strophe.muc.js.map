{"version":3,"file":"strophe.muc.js","sources":["../src/strophe.muc.coffee"],"sourcesContent":["###\r\n *Plugin to implement the MUC extension.\r\n   http://xmpp.org/extensions/xep-0045.html\r\n *Previous Author:\r\n    Nathan Zorn <nathan.zorn@gmail.com>\r\n *Complete CoffeeScript rewrite:\r\n    Andreas Guth <guth@dbis.rwth-aachen.de>\r\n###\r\n`import { $build, $iq, $msg, $pres, Strophe } from 'strophe.js';`\r\n\r\nStrophe.addConnectionPlugin 'muc',\r\n  _connection: null\r\n  _allowEscapeNode: true\r\n  rooms: {}\r\n  roomNames: []\r\n\r\n  ###Function\r\n  Initialize the MUC plugin. Sets the correct connection object and\r\n  extends the namesace.\r\n  ###\r\n  init: (conn) ->\r\n    @_connection = conn\r\n    @_muc_handler = null\r\n    # extend name space\r\n    #   NS.MUC - XMPP Multi-user chat namespace from XEP 45.\r\n    Strophe.addNamespace 'MUC_OWNER',     Strophe.NS.MUC+\"#owner\"\r\n    Strophe.addNamespace 'MUC_ADMIN',     Strophe.NS.MUC+\"#admin\"\r\n    Strophe.addNamespace 'MUC_USER',      Strophe.NS.MUC+\"#user\"\r\n    Strophe.addNamespace 'MUC_ROOMCONF',  Strophe.NS.MUC+\"#roomconfig\"\r\n    Strophe.addNamespace 'MUC_REGISTER', \"jabber:iq:register\"\r\n\r\n  ###Function\r\n  Join a multi-user chat room\r\n  Parameters:\r\n  (String) room - The multi-user chat room to join.\r\n  (String) nick - The nickname to use in the chat room. Optional\r\n  (Function) msg_handler_cb - The function call to handle messages from the\r\n  specified chat room.\r\n  (Function) pres_handler_cb - The function call back to handle presence\r\n  in the chat room.\r\n  (Function) roster_cb - The function call to handle roster info in the chat room\r\n  (String) password - The optional password to use. (password protected\r\n  rooms only)\r\n  (Object) history_attrs - Optional attributes for retrieving history\r\n  (XML DOM Element) extended_presence - Optional XML for extending presence\r\n  ###\r\n  join: (room, nick, msg_handler_cb, pres_handler_cb, roster_cb, password, history_attrs, extended_presence) ->\r\n    room_nick = @test_append_nick(room, nick)\r\n    msg = $pres(\r\n      from: @_connection.jid\r\n      to: room_nick )\r\n    .c(\"x\", xmlns: Strophe.NS.MUC)\r\n\r\n    if history_attrs?\r\n      msg = msg.c(\"history\", history_attrs).up()\r\n\r\n    if password?\r\n      msg.cnode Strophe.xmlElement(\"password\", [], password)\r\n\r\n    if extended_presence?\r\n      msg.up().cnode extended_presence\r\n\r\n    # One handler for all rooms that dispatches to room callbacks\r\n    @_muc_handler ?=  @_connection.addHandler (stanza) =>\r\n      from = stanza.getAttribute 'from'\r\n      return true unless from\r\n      roomname = from.split(\"/\")[0]\r\n\r\n      # Abort if the stanza is not for a known MUC\r\n      return true unless @rooms[roomname]\r\n      room = @rooms[roomname]\r\n\r\n      handlers = {}\r\n\r\n      #select the right handlers\r\n      if stanza.nodeName is \"message\"\r\n        handlers = room._message_handlers\r\n      else if stanza.nodeName is \"presence\"\r\n        xquery = stanza.getElementsByTagName \"x\"\r\n        if xquery.length > 0\r\n          # Handle only MUC user protocol\r\n          for x in xquery\r\n            xmlns = x.getAttribute \"xmlns\"\r\n            if xmlns and xmlns.match Strophe.NS.MUC\r\n              handlers = room._presence_handlers\r\n              break\r\n\r\n      # loop over selected handlers (if any) and remove on false\r\n      for id, handler of handlers\r\n        delete handlers[id] unless handler stanza, room\r\n\r\n      return true\r\n\r\n    unless @rooms.hasOwnProperty(room)\r\n      @rooms[room] = new XmppRoom(@, room, nick, password )\r\n      @rooms[room].addHandler 'presence', pres_handler_cb if pres_handler_cb\r\n      @rooms[room].addHandler 'message', msg_handler_cb if msg_handler_cb\r\n      @rooms[room].addHandler 'roster', roster_cb if roster_cb\r\n      @roomNames.push room\r\n\r\n    @_connection.send msg\r\n\r\n  ###Function\r\n  Leave a multi-user chat room\r\n  Parameters:\r\n  (String) room - The multi-user chat room to leave.\r\n  (String) nick - The nick name used in the room.\r\n  (Function) handler_cb - Optional function to handle the successful leave.\r\n  (String) exit_msg - optional exit message.\r\n  Returns:\r\n  iqid - The unique id for the room leave.\r\n  ###\r\n  leave: (room, nick, handler_cb, exit_msg) ->\r\n    id = @roomNames.indexOf room\r\n    delete @rooms[room]\r\n    if id >=0\r\n      @roomNames.splice id, 1\r\n      if @roomNames.length is 0\r\n        @_connection.deleteHandler @_muc_handler\r\n        @_muc_handler = null\r\n    room_nick = @test_append_nick room, nick\r\n    presenceid = @_connection.getUniqueId()\r\n    presence = $pres (\r\n      type: \"unavailable\"\r\n      id: presenceid\r\n      from: @_connection.jid\r\n      to: room_nick )\r\n\r\n    presence.c \"status\", exit_msg if exit_msg?\r\n\r\n    if handler_cb?\r\n      @_connection.addHandler(\r\n        handler_cb\r\n        null\r\n        \"presence\"\r\n        null\r\n        presenceid )\r\n\r\n    @_connection.send presence\r\n    return presenceid\r\n\r\n  ###Function\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (String) nick - The nick name used in the chat room.\r\n  (String) message - The plaintext message to send to the room.\r\n  (String) html_message - The message to send to the room with html markup.\r\n  (String) type - \"groupchat\" for group chat messages o\r\n                  \"chat\" for private chat messages\r\n  Returns:\r\n  msgiq - the unique id used to send the message\r\n  ###\r\n  message: (room, nick, message, html_message, type, msgid) ->\r\n    room_nick = @test_append_nick(room, nick)\r\n    type = type or if nick? then \"chat\" else \"groupchat\"\r\n    msgid = msgid or @_connection.getUniqueId()\r\n    msg = $msg(\r\n      to: room_nick\r\n      from: @_connection.jid\r\n      type: type\r\n      id: msgid )\r\n    .c(\"body\")\r\n    .t(message)\r\n    msg.up()\r\n    if html_message?\r\n      msg.c(\"html\", xmlns: Strophe.NS.XHTML_IM)\r\n      .c(\"body\", xmlns: Strophe.NS.XHTML)\r\n      .h(html_message)\r\n      if msg.node.childNodes.length is 0\r\n        # html creation or import failed somewhere; fallback to plaintext\r\n        parent = msg.node.parentNode\r\n        msg.up().up()\r\n        # get rid of the empty html element if we got invalid html\r\n        #so we don't send an empty message\r\n        msg.node.removeChild parent\r\n      else\r\n        msg.up().up()\r\n    msg.c(\"x\", xmlns: \"jabber:x:event\").c(\"composing\")\r\n    @_connection.send msg\r\n    return msgid\r\n\r\n  ###Function\r\n  Convenience Function to send a Message to all Occupants\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (String) message - The plaintext message to send to the room.\r\n  (String) html_message - The message to send to the room with html markup.\r\n  (String) msgid - Optional unique ID which will be set as the 'id' attribute of the stanza\r\n  Returns:\r\n  msgiq - the unique id used to send the message\r\n  ###\r\n  groupchat: (room, message, html_message, msgid) ->\r\n    @message room, null, message, html_message, undefined, msgid\r\n\r\n  ###Function\r\n  Send a mediated invitation.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (String) receiver - The invitation's receiver.\r\n  (String) reason - Optional reason for joining the room.\r\n  Returns:\r\n  msgiq - the unique id used to send the invitation\r\n  ###\r\n  invite: (room, receiver, reason) ->\r\n    msgid = @_connection.getUniqueId()\r\n    invitation = $msg(\r\n      from: @_connection.jid\r\n      to: room\r\n      id: msgid )\r\n    .c('x', xmlns: Strophe.NS.MUC_USER)\r\n    .c('invite', to: receiver)\r\n    invitation.c 'reason', reason if reason?\r\n    @_connection.send invitation\r\n    return msgid\r\n\r\n  ###Function\r\n  Send a mediated multiple invitation.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (Array) receivers - The invitation's receivers.\r\n  (String) reason - Optional reason for joining the room.\r\n  Returns:\r\n  msgiq - the unique id used to send the invitation\r\n  ###\r\n  multipleInvites: (room, receivers, reason) ->\r\n    msgid = @_connection.getUniqueId()\r\n    invitation = $msg(\r\n      from: @_connection.jid\r\n      to: room\r\n      id: msgid )\r\n    .c('x', xmlns: Strophe.NS.MUC_USER)\r\n\r\n    for receiver in receivers\r\n      invitation.c 'invite', to: receiver\r\n      if reason?\r\n        invitation.c 'reason', reason\r\n        invitation.up()\r\n      invitation.up()\r\n\r\n    @_connection.send invitation\r\n    return msgid\r\n\r\n  ###Function\r\n  Send a direct invitation.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (String) receiver - The invitation's receiver.\r\n  (String) reason - Optional reason for joining the room.\r\n  (String) password - Optional password for the room.\r\n  Returns:\r\n  msgiq - the unique id used to send the invitation\r\n  ###\r\n  directInvite: (room, receiver, reason, password) ->\r\n    msgid = @_connection.getUniqueId()\r\n    attrs =\r\n      xmlns: 'jabber:x:conference'\r\n      jid: room\r\n    attrs.reason = reason if reason?\r\n    attrs.password = password if password?\r\n    invitation = $msg(\r\n      from: @_connection.jid\r\n      to: receiver\r\n      id: msgid )\r\n    .c('x', attrs)\r\n    @_connection.send invitation\r\n    return msgid\r\n\r\n  ###Function\r\n  Queries a room for a list of occupants\r\n  (String) room - The multi-user chat room name.\r\n  (Function) success_cb - Optional function to handle the info.\r\n  (Function) error_cb - Optional function to handle an error.\r\n  Returns:\r\n  id - the unique id used to send the info request\r\n  ###\r\n  queryOccupants: (room, success_cb, error_cb) ->\r\n    attrs = xmlns: Strophe.NS.DISCO_ITEMS\r\n    info = $iq(\r\n      from:this._connection.jid\r\n      to:room\r\n      type:'get' )\r\n    .c('query', attrs)\r\n    @_connection.sendIQ info, success_cb, error_cb\r\n\r\n  ###Function\r\n  Start a room configuration.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (Function) handler_cb - Optional function to handle the config form.\r\n  Returns:\r\n  id - the unique id used to send the configuration request\r\n  ###\r\n  configure: (room, handler_cb, error_cb) ->\r\n    # send iq to start room configuration\r\n    config = $iq(\r\n      to:room\r\n      type: \"get\" )\r\n    .c(\"query\", xmlns: Strophe.NS.MUC_OWNER)\r\n    stanza = config.tree()\r\n    @_connection.sendIQ stanza, handler_cb, error_cb\r\n\r\n  ###Function\r\n  Cancel the room configuration\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  Returns:\r\n  id - the unique id used to cancel the configuration.\r\n  ###\r\n  cancelConfigure: (room) ->\r\n    #send iq to start room configuration\r\n    config = $iq(\r\n      to: room\r\n      type: \"set\" )\r\n    .c(\"query\", xmlns: Strophe.NS.MUC_OWNER)\r\n    .c(\"x\", xmlns: \"jabber:x:data\", type: \"cancel\")\r\n    stanza = config.tree()\r\n    @_connection.sendIQ stanza\r\n\r\n  ###Function\r\n  Save a room configuration.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (Array) config- Form Object or an array of form elements used to configure the room.\r\n  Returns:\r\n  id - the unique id used to save the configuration.\r\n  ###\r\n  saveConfiguration: (room, config, success_cb, error_cb) ->\r\n    iq = $iq(\r\n      to: room\r\n      type: \"set\" )\r\n    .c(\"query\", xmlns: Strophe.NS.MUC_OWNER)\r\n    if typeof Strophe.x isnt \"undefined\" and typeof Strophe.x.Form isnt \"undefined\" and config instanceof Strophe.x.Form\r\n      config.type = \"submit\"\r\n      iq.cnode config.toXML()\r\n    else\r\n      iq.c(\"x\", xmlns: \"jabber:x:data\", type: \"submit\")\r\n      iq.cnode(conf).up() for conf in config\r\n    stanza = iq.tree()\r\n    @_connection.sendIQ stanza, success_cb, error_cb\r\n\r\n  ###Function\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  Returns:\r\n  id - the unique id used to create the chat room.\r\n  ###\r\n  createInstantRoom: (room, success_cb, error_cb) ->\r\n    roomiq = $iq(\r\n      to: room\r\n      type: \"set\" )\r\n    .c(\"query\", xmlns: Strophe.NS.MUC_OWNER)\r\n    .c(\"x\", xmlns: \"jabber:x:data\", type: \"submit\")\r\n    @_connection.sendIQ roomiq.tree(), success_cb, error_cb\r\n\r\n  ###Function\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (Object) config - the configuration. ex: {\"muc#roomconfig_publicroom\": \"0\", \"muc#roomconfig_persistentroom\": \"1\"}\r\n  Returns:\r\n  id - the unique id used to create the chat room.\r\n  ###\r\n  createConfiguredRoom: (room, config, success_cb, error_cb) ->\r\n    roomiq = $iq(\r\n      to: room\r\n      type: \"set\" )\r\n    .c(\"query\", xmlns: Strophe.NS.MUC_OWNER)\r\n    .c(\"x\", xmlns: \"jabber:x:data\", type: \"submit\")\r\n\r\n    # Owner submits configuration form\r\n    roomiq.c('field', { 'var': 'FORM_TYPE' }).c('value').t('http://jabber.org/protocol/muc#roomconfig').up().up();\r\n\r\n    roomiq.c('field', { 'var': k}).c('value').t(v).up().up() for own k, v of config\r\n\r\n    @_connection.sendIQ roomiq.tree(), success_cb, error_cb\r\n\r\n  ###Function\r\n  Set the topic of the chat room.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (String) topic - Topic message.\r\n  ###\r\n  setTopic: (room, topic) ->\r\n    msg = $msg(\r\n      to: room\r\n      from: @_connection.jid\r\n      type: \"groupchat\" )\r\n    .c(\"subject\", xmlns: \"jabber:client\")\r\n    .t(topic)\r\n    @_connection.send msg.tree()\r\n\r\n  ###Function\r\n  Internal Function that Changes the role or affiliation of a member\r\n  of a MUC room. This function is used by modifyRole and modifyAffiliation.\r\n  The modification can only be done by a room moderator. An error will be\r\n  returned if the user doesn't have permission.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (Object) item - Object with nick and role or jid and affiliation attribute\r\n  (String) reason - Optional reason for the change.\r\n  (Function) handler_cb - Optional callback for success\r\n  (Function) error_cb - Optional callback for error\r\n  Returns:\r\n  iq - the id of the mode change request.\r\n  ###\r\n  _modifyPrivilege: (room, item, reason, handler_cb, error_cb) ->\r\n    iq = $iq(\r\n      to: room\r\n      type: \"set\" )\r\n    .c(\"query\", xmlns: Strophe.NS.MUC_ADMIN)\r\n    .cnode(item.node)\r\n\r\n    iq.c(\"reason\", reason) if reason?\r\n\r\n    @_connection.sendIQ iq.tree(), handler_cb, error_cb\r\n\r\n  ###Function\r\n  Changes the role of a member of a MUC room.\r\n  The modification can only be done by a room moderator. An error will be\r\n  returned if the user doesn't have permission.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (String) nick - The nick name of the user to modify.\r\n  (String) role - The new role of the user.\r\n  (String) affiliation - The new affiliation of the user.\r\n  (String) reason - Optional reason for the change.\r\n  (Function) handler_cb - Optional callback for success\r\n  (Function) error_cb - Optional callback for error\r\n  Returns:\r\n  iq - the id of the mode change request.\r\n  ###\r\n  modifyRole: (room, nick, role, reason, handler_cb, error_cb) ->\r\n    item = $build(\"item\"\r\n      nick: nick\r\n      role: role )\r\n\r\n    @_modifyPrivilege room, item, reason, handler_cb, error_cb\r\n\r\n  kick: (room, nick, reason, handler_cb, error_cb) ->\r\n    @modifyRole room, nick, 'none', reason, handler_cb, error_cb\r\n\r\n  voice: (room, nick, reason, handler_cb, error_cb) ->\r\n    @modifyRole room, nick, 'participant', reason, handler_cb, error_cb\r\n\r\n  mute: (room, nick, reason, handler_cb, error_cb) ->\r\n    @modifyRole room, nick, 'visitor', reason, handler_cb, error_cb\r\n\r\n  op: (room, nick, reason, handler_cb, error_cb) ->\r\n    @modifyRole room, nick, 'moderator', reason, handler_cb, error_cb\r\n\r\n  deop: (room, nick, reason, handler_cb, error_cb) ->\r\n    @modifyRole room, nick, 'participant', reason, handler_cb, error_cb\r\n\r\n  ###Function\r\n  Changes the affiliation of a member of a MUC room.\r\n  The modification can only be done by a room moderator. An error will be\r\n  returned if the user doesn't have permission.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (String) jid  - The jid of the user to modify.\r\n  (String) affiliation - The new affiliation of the user.\r\n  (String) reason - Optional reason for the change.\r\n  (Function) handler_cb - Optional callback for success\r\n  (Function) error_cb - Optional callback for error\r\n  Returns:\r\n  iq - the id of the mode change request.\r\n  ###\r\n  modifyAffiliation: (room, jid, affiliation, reason, handler_cb, error_cb) ->\r\n    item = $build(\"item\"\r\n      jid: jid\r\n      affiliation: affiliation )\r\n\r\n    @_modifyPrivilege room, item, reason, handler_cb, error_cb\r\n\r\n  ban: (room, jid, reason, handler_cb, error_cb) ->\r\n    @modifyAffiliation room, jid, 'outcast', reason, handler_cb, error_cb\r\n\r\n  member: (room, jid, reason, handler_cb, error_cb) ->\r\n    @modifyAffiliation room, jid, 'member', reason, handler_cb, error_cb\r\n\r\n  revoke: (room, jid, reason, handler_cb, error_cb) ->\r\n    @modifyAffiliation room, jid, 'none', reason, handler_cb, error_cb\r\n\r\n  owner: (room, jid, reason, handler_cb, error_cb) ->\r\n    @modifyAffiliation room, jid, 'owner', reason, handler_cb, error_cb\r\n\r\n  admin: (room, jid, reason, handler_cb, error_cb) ->\r\n    @modifyAffiliation room, jid, 'admin', reason, handler_cb, error_cb\r\n\r\n  ###Function\r\n  Change the current users nick name.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (String) user - The new nick name.\r\n  ###\r\n  changeNick: (room, user) ->\r\n    room_nick = @test_append_nick room, user\r\n    presence = $pres(\r\n      from: @_connection.jid\r\n      to: room_nick\r\n      id: @_connection.getUniqueId() )\r\n    @_connection.send presence.tree()\r\n\r\n  ###Function\r\n  Change the current users status.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (String) user - The current nick.\r\n  (String) show - The new show-text.\r\n  (String) status - The new status-text.\r\n  ###\r\n  setStatus: (room, user, show, status) ->\r\n    room_nick = @test_append_nick room, user\r\n    presence = $pres(\r\n      from: @_connection.jid\r\n      to: room_nick )\r\n    presence.c('show', show).up() if show?\r\n    presence.c('status', status) if status?\r\n    @_connection.send presence.tree()\r\n\r\n  ###Function\r\n  Registering with a room.\r\n  @see http://xmpp.org/extensions/xep-0045.html#register\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (Function) handle_cb - Function to call for room list return.\r\n  (Function) error_cb - Function to call on error.\r\n  ###\r\n  registrationRequest: (room, handle_cb, error_cb) ->\r\n    iq = $iq(\r\n        to: room,\r\n        from: @_connection.jid,\r\n        type: \"get\"\r\n      )\r\n    .c(\"query\", xmlns: Strophe.NS.MUC_REGISTER)\r\n\r\n    @_connection.sendIQ iq, (stanza) ->\r\n      $fields = stanza.getElementsByTagName 'field'\r\n      length = $fields.length\r\n      fields =\r\n        required: []\r\n        optional: []\r\n\r\n      for $field in $fields\r\n        field =\r\n          var: $field.getAttribute 'var'\r\n          label: $field.getAttribute 'label'\r\n          type: $field.getAttribute 'type'\r\n\r\n        if $field.getElementsByTagName('required').length > 0\r\n          fields.required.push field\r\n        else\r\n          fields.optional.push field\r\n\r\n      handle_cb fields\r\n    , error_cb\r\n\r\n  ###Function\r\n  Submits registration form.\r\n  Parameters:\r\n  (String) room - The multi-user chat room name.\r\n  (Function) handle_cb - Function to call for room list return.\r\n  (Function) error_cb - Function to call on error.\r\n  ###\r\n  submitRegistrationForm: (room, fields, handle_cb, error_cb) ->\r\n    iq = $iq({\r\n      to: room,\r\n      type: \"set\"\r\n    }).c(\"query\", xmlns: Strophe.NS.MUC_REGISTER);\r\n    iq.c(\"x\",\r\n      xmlns: \"jabber:x:data\",\r\n      type: \"submit\"\r\n    );\r\n    iq.c('field', 'var': 'FORM_TYPE')\r\n    .c('value')\r\n    .t('http://jabber.org/protocol/muc#register')\r\n    .up().up()\r\n\r\n    for key, val of fields\r\n      iq.c('field', 'var': key)\r\n      .c('value')\r\n      .t(val).up().up()\r\n\r\n    @._connection.sendIQ iq, handle_cb, error_cb\r\n\r\n  ###Function\r\n  List all chat room available on a server.\r\n  Parameters:\r\n  (String) server - name of chat server.\r\n  (String) handle_cb - Function to call for room list return.\r\n  (String) error_cb - Function to call on error.\r\n  ###\r\n  listRooms: (server, handle_cb, error_cb) ->\r\n    iq = $iq(\r\n      to: server\r\n      from: @_connection.jid\r\n      type: \"get\" )\r\n    .c(\"query\", xmlns: Strophe.NS.DISCO_ITEMS)\r\n    @_connection.sendIQ iq, handle_cb, error_cb\r\n\r\n  test_append_nick: (room, nick) ->\r\n    if @_allowEscapeNode\r\n      node = Strophe.escapeNode(Strophe.getNodeFromJid(room))\r\n    else\r\n      node = Strophe.getNodeFromJid(room)\r\n    domain = Strophe.getDomainFromJid(room)\r\n    node + \"@\" + domain + if nick? then \"/#{nick}\" else \"\"\r\n\r\n  setAllowEscapeNode: (allowEscapeNode) ->\r\n    @_allowEscapeNode = allowEscapeNode\r\n    return\r\n\r\nclass XmppRoom\r\n\r\n\r\n  constructor: (@client, @name, @nick, @password) ->\r\n    @roster = {}\r\n    @_message_handlers = {}\r\n    @_presence_handlers = {}\r\n    @_roster_handlers = {}\r\n    @_handler_ids = 0\r\n    @client = @client.muc if @client.muc\r\n    @name = Strophe.getBareJidFromJid @name\r\n    @addHandler 'presence', @_roomRosterHandler\r\n\r\n  join: (msg_handler_cb, pres_handler_cb, roster_cb) ->\r\n    @client.join(@name, @nick, msg_handler_cb, pres_handler_cb, roster_cb, @password)\r\n\r\n  leave: (handler_cb, message) ->\r\n    @client.leave @name, @nick, handler_cb, message\r\n    delete @client.rooms[@name]\r\n\r\n  message: (nick, message, html_message, type) ->\r\n    @client.message @name, nick, message, html_message, type\r\n\r\n  groupchat: (message, html_message) ->\r\n    @client.groupchat @name, message, html_message\r\n\r\n  invite: (receiver, reason) ->\r\n    @client.invite @name, receiver, reason\r\n\r\n  multipleInvites: (receivers, reason) ->\r\n    @client.invite @name, receivers, reason\r\n\r\n  directInvite: (receiver, reason) ->\r\n    @client.directInvite @name, receiver, reason, @password\r\n\r\n  configure: (handler_cb) ->\r\n    @client.configure @name, handler_cb\r\n\r\n  cancelConfigure: ->\r\n    @client.cancelConfigure @name\r\n\r\n  saveConfiguration: (config) ->\r\n    @client.saveConfiguration @name, config\r\n\r\n  queryOccupants: (success_cb, error_cb) ->\r\n    @client.queryOccupants @name, success_cb, error_cb\r\n\r\n  setTopic: (topic) ->\r\n    @client.setTopic @name, topic\r\n\r\n  modifyRole: (nick, role, reason, success_cb, error_cb) ->\r\n    @client.modifyRole @name, nick, role, reason, success_cb, error_cb\r\n\r\n  kick: (nick, reason, handler_cb, error_cb) ->\r\n    @client.kick @name, nick, reason, handler_cb, error_cb\r\n\r\n  voice: (nick, reason, handler_cb, error_cb) ->\r\n    @client.voice @name, nick, reason, handler_cb, error_cb\r\n\r\n  mute: (nick, reason, handler_cb, error_cb) ->\r\n    @client.mute @name, nick, reason, handler_cb, error_cb\r\n\r\n  op: (nick, reason, handler_cb, error_cb) ->\r\n    @client.op @name, nick, reason, handler_cb, error_cb\r\n\r\n  deop: (nick, reason, handler_cb, error_cb) ->\r\n    @client.deop @name, nick, reason, handler_cb, error_cb\r\n\r\n  modifyAffiliation: (jid, affiliation, reason, success_cb, error_cb) ->\r\n    @client.modifyAffiliation @name,\r\n      jid, affiliation, reason,\r\n      success_cb, error_cb\r\n\r\n  ban: (jid, reason, handler_cb, error_cb) ->\r\n    @client.ban @name, jid, reason, handler_cb, error_cb\r\n\r\n  member: (jid, reason, handler_cb, error_cb) ->\r\n    @client.member @name, jid, reason, handler_cb, error_cb\r\n\r\n  revoke: (jid, reason, handler_cb, error_cb) ->\r\n    @client.revoke @name, jid, reason, handler_cb, error_cb\r\n\r\n  owner: (jid, reason, handler_cb, error_cb) ->\r\n    @client.owner @name, jid, reason, handler_cb, error_cb\r\n\r\n  admin: (jid, reason, handler_cb, error_cb) ->\r\n    @client.admin @name, jid, reason, handler_cb, error_cb\r\n\r\n  changeNick: (@nick) ->\r\n    @client.changeNick @name, nick\r\n\r\n  setStatus: (show, status) ->\r\n    @client.setStatus @name, @nick, show, status\r\n\r\n  ###Function\r\n  Adds a handler to the MUC room.\r\n    Parameters:\r\n  (String) handler_type - 'message', 'presence' or 'roster'.\r\n  (Function) handler - The handler function.\r\n  Returns:\r\n  id - the id of handler.\r\n  ###\r\n  addHandler: (handler_type, handler) ->\r\n    id = @_handler_ids++\r\n    switch handler_type\r\n      when 'presence'\r\n        @_presence_handlers[id] = handler\r\n      when 'message'\r\n        @_message_handlers[id] = handler\r\n      when 'roster'\r\n        @_roster_handlers[id] = handler\r\n      else\r\n        @_handler_ids--\r\n        return null\r\n    id\r\n\r\n  ###Function\r\n  Removes a handler from the MUC room.\r\n  This function takes ONLY ids returned by the addHandler function\r\n  of this room. passing handler ids returned by connection.addHandler\r\n  may brake things!\r\n    Parameters:\r\n  (number) id - the id of the handler\r\n  ###\r\n  removeHandler: (id) ->\r\n    delete @_presence_handlers[id]\r\n    delete @_message_handlers[id]\r\n    delete @_roster_handlers[id]\r\n\r\n  ###Function\r\n  Creates and adds an Occupant to the Room Roster.\r\n    Parameters:\r\n  (Object) data - the data the Occupant is filled with\r\n  Returns:\r\n  occ - the created Occupant.\r\n  ###\r\n  _addOccupant: (data) =>\r\n    occ = new Occupant data, @\r\n    @roster[occ.nick] = occ\r\n    occ\r\n\r\n  ###Function\r\n  The standard handler that managed the Room Roster.\r\n    Parameters:\r\n  (Object) pres - the presence stanza containing user information\r\n  ###\r\n  _roomRosterHandler: (pres) =>\r\n    data = XmppRoom._parsePresence pres\r\n    nick = data.nick\r\n    newnick = data.newnick or null\r\n    switch data.type\r\n      when 'error' then return true\r\n      when 'unavailable'\r\n        if newnick\r\n          data.nick = newnick\r\n          # If both Occupant Instances exist, switch the new one\r\n          # with the old renamed one\r\n          if @roster[nick] and @roster[newnick]\r\n            @roster[nick].update @roster[newnick]\r\n            @roster[newnick] = @roster[nick]\r\n          # If the renamed Occupant doesn't exist yet but the old one does,\r\n          # let the new one be the Same instance\r\n          if @roster[nick] and not @roster[newnick]\r\n            @roster[newnick] = @roster[nick].update data\r\n          # If the old Occupant is already deleted, do nothing\r\n          # unless @roster[newnick]\r\n          #   tmp_occ = @roster[newnick]\r\n          #   @roster[newnick].update(data).update(tmp_occ)\r\n        delete @roster[nick]\r\n      else\r\n        if @roster[nick]\r\n          @roster[nick].update data\r\n        else\r\n          @_addOccupant data\r\n    for id, handler of @_roster_handlers\r\n      delete @_roster_handlers[id] unless handler @roster, @\r\n    true\r\n\r\n  ###Function\r\n  Parses a presence stanza\r\n    Parameters:\r\n  (Object) data - the data extracted from the presence stanza\r\n  ###\r\n  @_parsePresence: (pres) ->\r\n    data = {}\r\n    data.nick = Strophe.getResourceFromJid pres.getAttribute(\"from\")\r\n    data.type = pres.getAttribute(\"type\")\r\n    data.states = []\r\n    for c in pres.childNodes\r\n      switch c.nodeName\r\n        when \"error\"\r\n          data.errorcode = c.getAttribute(\"code\")\r\n          data.error = c.childNodes[0]?.nodeName\r\n        when \"status\"\r\n          data.status = c.textContent or null\r\n        when \"show\"\r\n          data.show = c.textContent or null\r\n        when \"x\"\r\n          if c.getAttribute(\"xmlns\") is Strophe.NS.MUC_USER\r\n            for c2 in c.childNodes\r\n              switch c2.nodeName\r\n                when \"item\"\r\n                  data.affiliation = c2.getAttribute(\"affiliation\")\r\n                  data.role = c2.getAttribute(\"role\")\r\n                  data.jid = c2.getAttribute(\"jid\")\r\n                  data.newnick = c2.getAttribute(\"nick\")\r\n                when \"status\"\r\n                  if c2.getAttribute(\"code\")\r\n                    data.states.push c2.getAttribute(\"code\")\r\n    data\r\n\r\nclass RoomConfig\r\n\r\n  constructor: (info) ->\r\n    @parse info if info?\r\n\r\n  parse: (result) =>\r\n    query = result.getElementsByTagName(\"query\")[0].childNodes\r\n    @identities =  []\r\n    @features =  []\r\n    @x = []\r\n    for child in query\r\n      attrs = child.attributes\r\n      switch child.nodeName\r\n        when \"identity\"\r\n          identity = {}\r\n          identity[attr.name] = attr.textContent for attr in attrs\r\n          @identities.push identity\r\n        when \"feature\"\r\n          @features.push child.getAttribute(\"var\")\r\n        when \"x\"\r\n          break if (\r\n            (not child.childNodes[0].getAttribute(\"var\") is 'FORM_TYPE') or\r\n            (not child.childNodes[0].getAttribute(\"type\") is 'hidden') )\r\n          for field in child.childNodes when not field.attributes.type\r\n            @x.push (\r\n              var: field.getAttribute(\"var\")\r\n              label: field.getAttribute(\"label\") or \"\"\r\n              value: field.firstChild.textContent or \"\" )\r\n\r\n    \"identities\": @identities, \"features\": @features, \"x\": @x\r\n\r\nclass Occupant\r\n  constructor: (data, @room) ->\r\n    @update data\r\n\r\n  modifyRole: (role, reason, success_cb, error_cb) =>\r\n    @room.modifyRole @nick, role, reason, success_cb, error_cb\r\n\r\n  kick: (reason, handler_cb, error_cb) =>\r\n    @room.kick @nick, reason, handler_cb, error_cb\r\n\r\n  voice: (reason, handler_cb, error_cb) =>\r\n    @room.voice @nick, reason, handler_cb, error_cb\r\n\r\n  mute: (reason, handler_cb, error_cb) =>\r\n    @room.mute @nick, reason, handler_cb, error_cb\r\n\r\n  op: (reason, handler_cb, error_cb) =>\r\n    @room.op @nick, reason, handler_cb, error_cb\r\n\r\n  deop: (reason, handler_cb, error_cb) =>\r\n    @room.deop @nick, reason, handler_cb, error_cb\r\n\r\n  modifyAffiliation: (affiliation, reason, success_cb, error_cb) =>\r\n    @room.modifyAffiliation @jid, affiliation, reason, success_cb, error_cb\r\n\r\n  ban: (reason, handler_cb, error_cb) =>\r\n    @room.ban @jid, reason, handler_cb, error_cb\r\n\r\n  member: (reason, handler_cb, error_cb) =>\r\n    @room.member @jid, reason, handler_cb, error_cb\r\n\r\n  revoke: (reason, handler_cb, error_cb) =>\r\n    @room.revoke @jid, reason, handler_cb, error_cb\r\n\r\n  owner: (reason, handler_cb, error_cb) =>\r\n    @room.owner @jid, reason, handler_cb, error_cb\r\n\r\n  admin: (reason, handler_cb, error_cb) =>\r\n    @room.admin @jid, reason, handler_cb, error_cb\r\n\r\n  update: (data) =>\r\n    @nick         = data.nick         or null\r\n    @affiliation  = data.affiliation  or null\r\n    @role         = data.role         or null\r\n    @jid          = data.jid          or null\r\n    @status       = data.status       or null\r\n    @show         = data.show         or null\r\n    @\r\n\r\n"],"names":["Strophe","$pres","$msg","$iq","$build"],"mappings":"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"}